generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  emailVerified Boolean  @default(false)
  name          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Your existing relations
  authSessions CustomAuthSession[]
  recordings   Recording[]

  // Better Auth relations
  accounts Account[]
  sessions Session[]
}

model Recording {
  id         String          @id @default(cuid())
  title      String
  userId     String
  audioUrl   String?
  transcript String?
  summary    String?
  status     RecordingStatus @default(ACTIVE)
  duration   Int?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CustomAuthSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

//
// ⚡ Correct Better Auth account model for email+password
//
model Account {
  id         String   @id @default(cuid())
  userId     String
  type       String // REQUIRED by Better Auth
  providerId String // REQUIRED by Better Auth
  accountId  String // REQUIRED by Better Auth
  password   String? // only used for credentials
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

//
// ⚡ Better Auth session model
//
model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt  
  ipAddress String?  
  userAgent String? 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

//
// ⚡ Better Auth email verification model
//
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum RecordingStatus {
  ACTIVE
  RECORDING
  PAUSED
  PROCESSING
  COMPLETED
}
